<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhatsApp Guidelines</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header class="header" id="main-header" hidden>
      <h1>WhatsApp Guidelines Evaluation</h1>
      <p>Help us understand what guidelines fit your group best. This app runs locally in your browser and processes your chat text on your device.</p>
    </header>

    <section class="panel" id="landing-panel">
      <div class="field">
        <span>How did you get here?</span>
        <div class="options">
          <label><input type="radio" name="source" value="research" /> The researchers gave me a code</label>
          <label><input type="radio" name="source" value="prolific" /> I'm here from Prolific</label>
          <label><input type="radio" name="source" value="clickworker" /> I'm here from Clickworker</label>
        </div>
      </div>
      <div class="field" id="source-id-field" hidden>
        <span id="source-id-label">Enter your code</span>
        <input id="source-id" type="text" placeholder="Enter your code/ID" />
      </div>
      <button id="start-btn" class="primary" disabled>Continue</button>
    </section>

    <section class="panel" id="consent-panel" hidden>
      <h2>CONSENT TO PARTICIPATE IN RESEARCH</h2>
      <h3 style="margin-top: 0.5rem;">Helping Admins Write Grounded Rules for WhatsApp Groups</h3>

      <p><strong>Principal Investigators:</strong> Kiran Garimella, PhD (Rutgers University) and Aditya Vashistha, PhD (Cornell University)</p>
      <p>This form describes a research study. Please read carefully and ask questions before deciding whether to participate. Participation is voluntary.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">PURPOSE</h4>
      <p>This research examines how people evaluate content moderation rules for WhatsApp groups. Your responses will help improve online community governance tools.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">PROCEDURES</h4>
      <p>If you agree to participate, you will complete a single 25-30 minute online session:</p>
      <ol>
        <li>Answer questions about your background</li>
        <li>Upload a WhatsApp chat export from one of your groups. Personal information is removed on your device before transmission</li>
        <li>Review 15 moderation rules and rank them by preference</li>
        <li>Answer questions about your experience</li>
      </ol>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">ELIGIBILITY</h4>
      <p>You must be: 18+ years old, residing in India, fluent in English, an active WhatsApp group member with ability to export chat history.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">RISKS</h4>
      <p>Risks are minimal. Your WhatsApp chat is anonymized on your device before transmission, encrypted during transfer, and immediately deleted after processing. You may experience mild discomfort reviewing your chat content. You can withdraw anytime.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">BENEFITS</h4>
      <p>No direct benefits. Your participation contributes to research on online community governance.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">COMPENSATION</h4>
      <p>You will receive $2.5 USD via Prolific/Clickworker upon completion. Pro-rated payment if you withdraw early.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">CONFIDENTIALITY</h4>
      <p>Your identity is protected. We collect only anonymous platform IDs, no names or emails. All data is encrypted and stored on secure Rutgers servers. Only the 4-person research team has access. Results are reported in aggregate only. Data retained for 3 years per university policy, then deleted.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">VOLUNTARY PARTICIPATION</h4>
      <p>Participation is voluntary. You may withdraw anytime by closing your browser without penalty.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">QUESTIONS</h4>
      <p>Study questions: Sudhamshu Hosamane [sh1779@scarletmail.rutgers.edu] or Farhana Shahid [fs468@cornell.edu]</p>
      <p>Learn more about IRB practices and privacy: IRBOffice@research.rutgers.edu or irbhp@cornell.edu</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">CONSENT</h4>
      <p><strong>I, <span id="consent-participant-id" style="text-decoration: underline;">__________</span>, confirm that:</strong></p>

      <div class="options">
        <label><input type="checkbox" id="consent-read" /> I have read this form and understand the study</label>
        <label><input type="checkbox" id="consent-age" /> I am 18 years or older</label>
        <label><input type="checkbox" id="consent-voluntary" /> I understand participation is voluntary and I can withdraw anytime</label>
        <label><input type="checkbox" id="consent-confidential" /> I understand my data will be anonymized and kept confidential</label>
        <label><input type="checkbox" id="consent-agree" /> I voluntarily agree to participate</label>
      </div>

      <div class="consent-buttons">
        <button id="consent-agree-btn" class="primary" disabled>I AGREE TO PARTICIPATE</button>
        <button id="consent-decline-btn" class="primary outline" style="background: transparent; color: var(--error); border-color: var(--error);">I DO NOT WISH TO PARTICIPATE</button>
      </div>

      <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--muted);">
        <strong>Save or print this form for your records:</strong><br>
        • On desktop: Press <strong>Ctrl+P</strong> (Windows) or <strong>Cmd+P</strong> (Mac) and select "Save as PDF"<br>
        • On mobile: Tap the menu (⋮) and select "Print" or "Save as PDF"
      </p>

      <button id="consent-continue-btn" class="primary" style="margin-top: 1.5rem; display: block;" disabled>Continue</button>
    </section>

    <section class="panel" id="instructions-panel" hidden>
      <p>We'll generate draft guidelines from your group's chat. Your chat is processed on your device. Only pseudonymous sender labels (User 01, User 02, …) are included in any analysis.</p>
      <button id="instructions-btn" class="primary">Next</button>
    </section>

    <section class="panel" id="upload-panel" hidden>
      <div id="drop-zone" class="drop-zone" tabindex="0" aria-label="Drop WhatsApp zip or chat .txt here">
        <p class="dz-instructions"><strong>Drop a zip or chat .txt</strong> or use the pickers below.</p>
        <p class="dz-hint">Pick a .zip or the chat .txt (usually <code>_chat.txt</code>). Media files are ignored.</p>
      </div>
      <div class="picker-row">
        <label class="picker-label" for="chat-zip">Choose zip:</label>
        <input id="chat-zip" type="file" accept=".zip" />
      </div>
      <div class="picker-row">
        <label class="picker-label" for="chat-txt">Or choose chat .txt:</label>
        <input id="chat-txt" type="file" accept=".txt" />
      </div>
      <p class="tip">If Google Drive fails on Android, download the file to your device and pick it from Files.</p>
      <div class="file-status" id="file-status" role="status" aria-live="polite"></div>
      <div class="field">
        <span>Below is a snapshot of the anonymized transcript. We do all of the anonymization (removing user names, email IDs, phone numbers and other personal information) on your device. You can send us this anonymized transcript by clicking the button below.</span>
        <div id="transcript-preview" class="transcript-preview" aria-label="Transcript preview" tabindex="0"></div>
      </div>

      <h3 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">About You</h3>

      <label class="field">
        <span>Age</span>
        <input id="demo-age" type="number" min="18" max="100" placeholder="Enter your age" />
      </label>

      <label class="field">
        <span>Gender</span>
        <select id="demo-gender">
          <option value="" selected disabled>Select</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Prefer not to say">Prefer not to say</option>
        </select>
      </label>

      <label class="field">
        <span>District and State of residence</span>
        <input id="demo-location" type="text" placeholder="e.g., Bangalore, Karnataka" />
      </label>

      <label class="field">
        <span>Primary language(s) you speak</span>
        <input id="demo-languages" type="text" placeholder="e.g., English, Hindi, Kannada" />
      </label>

      <label class="field">
        <span>Education level</span>
        <select id="demo-education">
          <option value="" selected disabled>Select your highest education</option>
          <option value="Below 10th standard">Below 10th standard</option>
          <option value="10th standard">10th standard</option>
          <option value="12th standard / PUC">12th standard / PUC</option>
          <option value="Diploma">Diploma</option>
          <option value="Bachelor's degree">Bachelor's degree</option>
          <option value="Master's degree">Master's degree</option>
          <option value="Doctoral degree (PhD)">Doctoral degree (PhD)</option>
          <option value="Professional degree (Medical, Law, etc.)">Professional degree (Medical, Law, etc.)</option>
        </select>
      </label>

      <label class="field">
        <span>How often do you use WhatsApp?</span>
        <select id="demo-wa-frequency">
          <option value="" selected disabled>Select</option>
          <option value="Never">Never</option>
          <option value="Rarely">Rarely</option>
          <option value="Sometimes">Sometimes</option>
          <option value="Often">Often</option>
          <option value="Daily">Daily</option>
        </select>
      </label>

      <label class="field">
        <span>How many WhatsApp groups are you currently active in?</span>
        <select id="demo-wa-groups">
          <option value="" selected disabled>Select</option>
          <option value="0">0</option>
          <option value="1-3">1-3</option>
          <option value="4-7">4-7</option>
          <option value="8-15">8-15</option>
          <option value="16+">16+</option>
        </select>
      </label>

      <label class="field">
        <span>How many WhatsApp groups do you serve as an admin or moderator?</span>
        <select id="demo-wa-admin-groups">
          <option value="" selected disabled>Select</option>
          <option value="0">0</option>
          <option value="1-3">1-3</option>
          <option value="4-7">4-7</option>
          <option value="8-15">8-15</option>
          <option value="16+">16+</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I have experience moderating online communities"</span>
        <select id="demo-moderation-exp">
          <option value="" selected disabled>Select your response</option>
          <option value="Strongly Disagree">Strongly Disagree</option>
          <option value="Disagree">Disagree</option>
          <option value="Neutral">Neutral</option>
          <option value="Agree">Agree</option>
          <option value="Strongly Agree">Strongly Agree</option>
        </select>
      </label>

      <label class="field">
        <span>How long have you been a WhatsApp admin?</span>
        <select id="demo-admin-duration">
          <option value="" selected disabled>Select</option>
          <option value="None">None</option>
          <option value="Less than 1 year">Less than 1 year</option>
          <option value="1-3 years">1-3 years</option>
          <option value="3-5 years">3-5 years</option>
          <option value="5+ years">5+ years</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I am confident in my ability to write clear guidelines"</span>
        <select id="demo-writing-confidence">
          <option value="" selected disabled>Select your response</option>
          <option value="Not at all">Not at all</option>
          <option value="Slightly">Slightly</option>
          <option value="Moderately">Moderately</option>
          <option value="Very">Very</option>
          <option value="Extremely">Extremely</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I am good at explaining complex policies simply"</span>
        <select id="demo-explanation-skill">
          <option value="" selected disabled>Select your response</option>
          <option value="Not at all">Not at all</option>
          <option value="Slightly">Slightly</option>
          <option value="Moderately">Moderately</option>
          <option value="Very">Very</option>
          <option value="Extremely">Extremely</option>
        </select>
      </label>

      <label class="field">
        <span>If you are reading this question carefully, please select "Somewhat Agree"</span>
        <select id="demo-attention-check">
          <option value="" selected disabled>Select your response</option>
          <option value="Strongly Disagree">Strongly Disagree</option>
          <option value="Disagree">Disagree</option>
          <option value="Somewhat Agree">Somewhat Agree</option>
          <option value="Agree">Agree</option>
          <option value="Strongly Agree">Strongly Agree</option>
        </select>
      </label>

      <button id="approve-btn" class="primary" disabled>Approve and Continue</button>
    </section>

    <section class="panel" id="group-panel" hidden>
      <h2>1. Describe the Group</h2>
      <label class="field">
        <span>Group type</span>
        <select id="group-type">
          <option value="" selected disabled>Select a category</option>
          <option value="Personal">Personal (Family / Friends / Social circle / Neighborhood)</option>
          <option value="Professional">Professional (Workplace / Project / Alumni / Professional Network / Client)</option>
          <option value="Learning">Learning (Class / Study / Research group / School parent group)</option>
          <option value="Hobby &amp; Community of Practice">Hobby &amp; Community of Practice (Sports / Arts / Music / Religion / Coding / Politics)</option>
          <option value="Civic / Volunteer / Mutual Aid">Civic / Volunteer / Mutual Aid (Resident Welfare / Non-profit / Crisis coordination)</option>
          <option value="Marketplace and logistics">Marketplace and Logistics</option>
          <option value="Public Facing and Announcement">Public Facing and Announcement</option>
          <option value="Other">Other</option>
        </select>
      </label>
      <div class="field" id="group-type-other-field" hidden>
        <span>Describe other group type</span>
        <input id="group-type-other" type="text" placeholder="e.g., Resident hobby meetup, language exchange, carpool coordination" />
      </div>
      <!-- <p class="tip">Gemini API access is preconfigured for this prototype.</p> -->
    </section>

    <section class="panel" id="generation-panel" hidden>
      <p>Click the button below to generate guidelines. This will take approximately one minute.</p>
      <button id="generate-btn" class="primary" disabled>Click here for some suggestive guidelines</button>
      <div id="loading" class="loading" hidden>
        <span class="spinner" aria-hidden="true"></span>
        <span class="loading-text">Please wait for 1 minute...</span>
      </div>
      <div id="generation-errors" class="errors" role="alert"></div>
      <div id="proceed-instruction" class="note" hidden>
        <p><strong>Guidelines ready.</strong> Scroll down to rank them.</p>
      </div>
    </section>

    <section class="panel" id="ranking-panel" hidden>
      <h2>Rank the Rules</h2>
      <p>Drag up to seven rules into the ranking zone. The list is ordered from Rank 1 at the top to Rank 7 at the bottom. You must rank at least one rule.</p>
      <p id="ranking-note" class="note" hidden></p>
      <div class="ranking-layout">
        <section class="ranking-column">
          <header class="column-header">
            <h3>Ranking Zone</h3>
            <p>Drop rules here to assign their rank. Drag within the list to reorder, or back to the pool to remove.</p>
          </header>
          <div id="ranked-list" class="rule-list drop-target" role="list" aria-label="Ranked rules"></div>
        </section>
        <section class="ranking-column">
          <header class="column-header">
            <h3>All Rules</h3>
            <p>Start by dragging rules from here.</p>
          </header>
          <div id="available-list" class="rule-list" role="list" aria-label="Available rules"></div>
        </section>
      </div>
      <button id="submit-rankings" class="primary outline">Submit Rankings</button>
      <div id="ranking-error" class="errors" role="alert"></div>
      <div id="ranking-summary" class="summary" hidden></div>
    </section>
  </main>

  <template id="rule-card-template">
    <article class="rule-card" draggable="true">
      <span class="rule-rank" aria-hidden="true"></span>
      <div class="rule-content">
        <p class="rule-text"></p>
        <p class="rule-reason"></p>
      </div>
    </article>
  </template>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
