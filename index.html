<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhatsApp Rules</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <header class="header" id="main-header" hidden>
      <h1>WhatsApp Rules Evaluation</h1>
      <p>Help us understand what rules fit your group best. This app runs locally in your browser and processes your chat text on your device.</p>
    </header>

    <section class="panel" id="landing-panel">
      <!-- University Logos -->
      <div class="logo-header">
        <img src="logos/cornell_logo_simple_b31b1b.png" alt="Cornell University" class="university-logo" />
        <img src="logos/RNB_H_RED_RGB.png" alt="Rutgers University" class="university-logo" />
      </div>

      <p>This is an academic study conducted by researchers at Cornell University and Rutgers University.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Purpose:</strong></h4>
      <p>In this study, we examine if AI can help create rules for WhatsApp groups.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Study Procedure:</strong></h4>
      <p>If you agree to participate, you will need to complete a 25-30 minute online session:</p>
      <ul>
        <li>First, you will upload a WhatsApp group chat from one of your groups. We will remove all personal information from the chat (e.g., name, phone number, address, media etc.) on your device before you upload them.</li>
        <li>Next, you will review some rules that will be generated by AI based on your uploaded WhatsApp group chat.</li>
        <li>Finally, you will answer some questions about your opinion of these rules.</li>
      </ul>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Eligibility:</strong></h4>
      <p>You must be:</p>
      <ul>
        <li>At least 18 years old,</li>
        <li>Living in India,</li>
        <li>Fluent in English,</li>
        <li>An active WhatsApp group admin.</li>
      </ul>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Risks:</strong></h4>
      <p>We expect minimal risk from your participation in this study. Your WhatsApp group chat will be completely anonymized on your device before you upload them. We will delete the group data after generating group rules. If you feel uncomfortable sharing your anonymous group chat, you can withdraw anytime.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Benefits</strong></h4>
      <p>No direct benefits. Your participation potentially helps improve WhatsApp group features.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Compensation</strong></h4>
      <p>You will receive $2.50 USD (~200 INR) via Prolific/Clickworker if you complete the study.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Confidentiality</strong></h4>
      <p>Your identity and data are protected. We will only collect your Prolific/ Clickworker ID to process compensation. All data will be encrypted and accessed by the research team only.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Voluntary participation</strong></h4>
      <p>Participation is voluntary. You may withdraw anytime by closing your browser. At this moment, we can only compensate those who complete the whole study.</p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Contact</strong></h4>
      <p>If you have any questions regarding the study or face any issue during the study, please email: Sudhamshu Hosamane [sh1779@scarletmail.rutgers.edu] or Farhana Shahid [fs468@cornell.edu]</p>
      <p>If you have any questions about your rights as a participant in this study, please contact: IRBOffice@research.rutgers.edu or <a href="mailto:irbhp@cornell.edu">irbhp@cornell.edu</a></p>

      <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;"><strong>Consent:</strong></h4>
      <p>I confirm that:</p>
      <ul>
        <li>I have read this form and understand the study</li>
        <li>I am 18 years or older</li>
        <li>I understand participation is voluntary and I can withdraw anytime</li>
        <li>I understand my data will be anonymized and kept confidential</li>
      </ul>

      <div class="consent-buttons">
        <button id="consent-agree-btn" class="primary">I AGREE TO PARTICIPATE</button>
        <button id="consent-decline-btn" class="primary outline" style="background: transparent; color: var(--error); border-color: var(--error);">I DO NOT WISH TO PARTICIPATE</button>
      </div>
    </section>

    <section class="panel" id="upload-panel" hidden>
      <!-- Prolific/Clickworker ID Input -->
      <p>Share your Prolific/ Clickworker ID. We only use this information to process your reimbursement.</p>
      <input id="source-id" type="text" placeholder="" style="width: 100%; padding: 0.65rem 0.75rem; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: inherit; font: inherit; margin-bottom: 1.5rem;" />

      <p style="margin-bottom: 1rem;">Upload WhatsApp group chat from one of your groups. Please select a group with:</p>

      <ul style="margin-bottom: 1rem;">
        <li>At least 3 members</li>
        <li>500 messages total, spanning at least 90 days, and at least 50 messages in the last 30 days</li>
      </ul>

      <p style="margin-bottom: 1.5rem;">We anonymize the chat on your device by removing names, phone numbers, addresses, photos etc. before creating group rules based on group conversations. We will delete the chat after creating group rules.</p>

      <div id="drop-zone" class="drop-zone" tabindex="0" aria-label="Drop WhatsApp zip or chat .txt here">
        <p class="dz-instructions"><strong>Drop a zip or chat .txt</strong> or use the pickers below.</p>
        <p class="dz-hint">Pick a .zip or the chat .txt (usually <code>_chat.txt</code>). Media files are ignored.</p>
      </div>
      <div class="picker-row">
        <label class="picker-label" for="chat-zip">Choose zip:</label>
        <input id="chat-zip" type="file" accept=".zip" />
      </div>
      <div class="picker-row">
        <label class="picker-label" for="chat-txt">Or choose chat .txt:</label>
        <input id="chat-txt" type="file" accept=".txt" />
      </div>
      <p class="tip">If Google Drive fails on Android, download the file to your device and pick it from Files.</p>
      <div class="file-status" id="file-status" role="status" aria-live="polite"></div>
      <div class="field">
        <span>Below is a snapshot of the anonymized transcript. We do all of the anonymization (removing user names, email IDs, phone numbers and other personal information) on your device. You can send us this anonymized transcript by clicking the button below.</span>
        <div id="transcript-preview" class="transcript-preview" aria-label="Transcript preview" tabindex="0"></div>
      </div>

      <button id="approve-btn" class="primary" disabled>Approve and Continue</button>

      <p style="margin-top: 2rem; margin-bottom: 1rem;">If you need guidance regarding how to export WhatsApp group chat, please follow step-by-step instructions below based on your device where you have access to WhatsApp:</p>

      <details class="instruction-section">
        <summary><strong>Desktop (Windows/Mac)</strong></summary>
        <div class="instruction-content">
          <img src="Desktop_instructions/Desktop1.png" alt="Desktop Step 1" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="Desktop_instructions/Desktop2.png" alt="Desktop Step 2" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="Desktop_instructions/Desktop 3.png" alt="Desktop Step 3" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="Desktop_instructions/Desktop4.png" alt="Desktop Step 4" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="Desktop_instructions/Desktop5.png" alt="Desktop Step 5" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="Desktop_instructions/Desktop6.png" alt="Desktop Step 6" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
        </div>
      </details>

      <details class="instruction-section">
        <summary><strong>iPhone (iOS)</strong></summary>
        <div class="instruction-content">
          <img src="ios_instructinos/ios1.png" alt="iPhone Step 1" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios2.png" alt="iPhone Step 2" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios4.png" alt="iPhone Step 4" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios5.png" alt="iPhone Step 5" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios6.png" alt="iPhone Step 6" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios7.png" alt="iPhone Step 7" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
          <img src="ios_instructinos/ios8.png" alt="iPhone Step 8" style="max-width: 100%; height: auto; margin: 1rem 0; border: 1px solid var(--border); border-radius: 4px;" />
        </div>
      </details>

      <details class="instruction-section">
        <summary><strong>Android Phone</strong></summary>
        <div class="instruction-content">
          <p style="color: var(--muted); font-style: italic;">Instructions coming soon.</p>
        </div>
      </details>
    </section>

    <section class="panel" id="group-panel" hidden>
      <label class="field">
        <select id="group-type">
          <option value="" selected disabled>Which of the following categories best fits your WhatsApp group</option>
          <option value="Personal">Personal (Family / Friends / Social circle / Neighborhood)</option>
          <option value="Professional">Professional (Workplace / Project / Alumni / Professional Network / Client)</option>
          <option value="Learning">Learning (Class / Study / Research group / School parent group)</option>
          <option value="Hobby &amp; Community of Practice">Hobby &amp; Community of Practice (Sports / Arts / Music / Religion / Coding / Politics)</option>
          <option value="Civic / Volunteer / Mutual Aid">Civic / Volunteer / Mutual Aid (Resident Welfare / Non-profit / Crisis coordination)</option>
          <option value="Marketplace and logistics">Marketplace and Logistics</option>
          <option value="Public Facing and Announcement">Public Facing and Announcement</option>
          <option value="Other">Other</option>
        </select>
      </label>
      <div class="field" id="group-type-other-field" hidden>
        <span>Describe other group type</span>
        <input id="group-type-other" type="text" placeholder="e.g., Resident hobby meetup, language exchange, carpool coordination" />
      </div>
    </section>

    <section class="panel" id="generation-panel" hidden>
      <p>Click the button below to get suggestions for group rules based on your WhatsApp group chat.</p>
      <button id="generate-btn" class="primary" disabled>Click here for some suggestive rules</button>
      <div id="loading" class="loading" hidden>
        <span class="spinner" aria-hidden="true"></span>
        <span class="loading-text">Please wait for 1 minute...</span>
      </div>
      <div id="generation-errors" class="errors" role="alert"></div>
      <div id="proceed-instruction" class="note" hidden>
        <p><strong>Guidelines ready.</strong> Scroll down to select the rules you would set for your group.</p>
      </div>
    </section>

    <section class="panel" id="ranking-panel" hidden>
      <p style="margin-bottom: 1.5rem;">Select up to 5 rules that you think are relevant to your group and that you are likely to set for your group. You must select between 1â€“5 rules.</p>
      <p id="ranking-note" class="note" hidden></p>
      <div id="rules-list" class="rules-checkbox-list"></div>
      <button id="submit-rankings" class="primary" style="margin-top: 1.5rem;">Submit Selections</button>
      <div id="ranking-error" class="errors" role="alert"></div>
    </section>

    <section class="panel" id="explanations-panel" hidden>
      <p>You have selected the following rule as relevant to your group. Briefly tell us why you selected this rule.</p>

      <div class="rule-display" style="border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin: 1rem 0; background: var(--accent-soft);">
        <p id="selected-rule-text" class="rule-text" style="font-size: 1.1em; font-weight: 700; margin-bottom: 0.5rem;"></p>
        <p id="selected-rule-reason" class="rule-reason" style="color: var(--muted); margin: 0;"></p>
      </div>

      <label class="field">
        <textarea id="selected-explanation" placeholder="Explain why you selected this rule (minimum 15 words)..." style="min-height: 100px; width: 100%;"></textarea>
        <span id="selected-word-count" style="color: var(--muted); font-size: 0.9rem; margin-top: 0.25rem;">0 words (minimum 15 required)</span>
      </label>

      <p style="margin-top: 2rem;">You did not select the following rule for your group. Briefly tell us why you did not select this rule.</p>

      <div class="rule-display" style="border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin: 1rem 0; background: var(--accent-soft);">
        <p id="non-selected-rule-text" class="rule-text" style="font-size: 1.1em; font-weight: 700; margin-bottom: 0.5rem;"></p>
        <p id="non-selected-rule-reason" class="rule-reason" style="color: var(--muted); margin: 0;"></p>
      </div>

      <label class="field">
        <textarea id="non-selected-explanation" placeholder="Explain why you did not select this rule (minimum 15 words)..." style="min-height: 100px; width: 100%;"></textarea>
        <span id="non-selected-word-count" style="color: var(--muted); font-size: 0.9rem; margin-top: 0.25rem;">0 words (minimum 15 required)</span>
      </label>

      <button id="explanations-continue" class="primary" disabled>Continue</button>
    </section>

    <section class="panel" id="demographics-panel" hidden>
      <h2>About You</h2>
      <p>Please answer these final questions about yourself.</p>

      <label class="field">
        <span>Age</span>
        <input id="demo-age-final" type="number" min="18" max="100" placeholder="Enter your age" />
      </label>

      <label class="field">
        <span>Gender</span>
        <select id="demo-gender-final">
          <option value="" selected disabled>Select</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Prefer not to say">Prefer not to say</option>
        </select>
      </label>

      <label class="field">
        <span>District and State of residence</span>
        <input id="demo-location-final" type="text" placeholder="e.g., Bangalore, Karnataka" />
      </label>

      <label class="field">
        <span>Primary language(s) you speak</span>
        <input id="demo-languages-final" type="text" placeholder="e.g., English, Hindi, Kannada" />
      </label>

      <label class="field">
        <span>Education level</span>
        <select id="demo-education-final">
          <option value="" selected disabled>Select your highest education</option>
          <option value="Below 10th standard">Below 10th standard</option>
          <option value="10th standard">10th standard</option>
          <option value="12th standard / PUC">12th standard / PUC</option>
          <option value="Diploma">Diploma</option>
          <option value="Bachelor's degree">Bachelor's degree</option>
          <option value="Master's degree">Master's degree</option>
          <option value="Doctoral degree (PhD)">Doctoral degree (PhD)</option>
          <option value="Professional degree (Medical, Law, etc.)">Professional degree (Medical, Law, etc.)</option>
        </select>
      </label>

      <label class="field">
        <span>How often do you use WhatsApp?</span>
        <select id="demo-wa-frequency-final">
          <option value="" selected disabled>Select</option>
          <option value="Never">Never</option>
          <option value="Rarely">Rarely</option>
          <option value="Sometimes">Sometimes</option>
          <option value="Often">Often</option>
          <option value="Daily">Daily</option>
        </select>
      </label>

      <label class="field">
        <span>How many WhatsApp groups are you currently active in?</span>
        <select id="demo-wa-groups-final">
          <option value="" selected disabled>Select</option>
          <option value="0">0</option>
          <option value="1-3">1-3</option>
          <option value="4-7">4-7</option>
          <option value="8-15">8-15</option>
          <option value="16+">16+</option>
        </select>
      </label>

      <label class="field">
        <span>How many WhatsApp groups do you serve as an admin or moderator?</span>
        <select id="demo-wa-admin-groups-final">
          <option value="" selected disabled>Select</option>
          <option value="0">0</option>
          <option value="1-3">1-3</option>
          <option value="4-7">4-7</option>
          <option value="8-15">8-15</option>
          <option value="16+">16+</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I have experience moderating online communities"</span>
        <select id="demo-moderation-exp-final">
          <option value="" selected disabled>Select your response</option>
          <option value="Strongly Disagree">Strongly Disagree</option>
          <option value="Disagree">Disagree</option>
          <option value="Neutral">Neutral</option>
          <option value="Agree">Agree</option>
          <option value="Strongly Agree">Strongly Agree</option>
        </select>
      </label>

      <label class="field">
        <span>How long have you been a WhatsApp admin?</span>
        <select id="demo-admin-duration-final">
          <option value="" selected disabled>Select</option>
          <option value="None">None</option>
          <option value="Less than 1 year">Less than 1 year</option>
          <option value="1-3 years">1-3 years</option>
          <option value="3-5 years">3-5 years</option>
          <option value="5+ years">5+ years</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I am confident in my ability to write clear guidelines"</span>
        <select id="demo-writing-confidence-final">
          <option value="" selected disabled>Select your response</option>
          <option value="Not at all">Not at all</option>
          <option value="Slightly">Slightly</option>
          <option value="Moderately">Moderately</option>
          <option value="Very">Very</option>
          <option value="Extremely">Extremely</option>
        </select>
      </label>

      <label class="field">
        <span>Please indicate your level of agreement: "I am good at explaining complex policies simply"</span>
        <select id="demo-explanation-skill-final">
          <option value="" selected disabled>Select your response</option>
          <option value="Not at all">Not at all</option>
          <option value="Slightly">Slightly</option>
          <option value="Moderately">Moderately</option>
          <option value="Very">Very</option>
          <option value="Extremely">Extremely</option>
        </select>
      </label>

      <label class="field">
        <span>If you are reading this question carefully, please select "Somewhat Agree"</span>
        <select id="demo-attention-check-final">
          <option value="" selected disabled>Select your response</option>
          <option value="Strongly Disagree">Strongly Disagree</option>
          <option value="Disagree">Disagree</option>
          <option value="Somewhat Agree">Somewhat Agree</option>
          <option value="Agree">Agree</option>
          <option value="Strongly Agree">Strongly Agree</option>
        </select>
      </label>

      <button id="submit-final" class="primary">Submit</button>
      <div id="final-submission-message" class="summary" hidden></div>
    </section>
  </main>

  <template id="rule-card-template">
    <article class="rule-card" draggable="true">
      <span class="rule-rank" aria-hidden="true"></span>
      <div class="rule-content">
        <p class="rule-text"></p>
        <p class="rule-reason"></p>
      </div>
    </article>
  </template>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" crossorigin="anonymous"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
